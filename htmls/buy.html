<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet"/>
        <link rel="stylesheet" href="../styles/navigation.css" />
        <link rel="stylesheet" href="../styles/tickets.css" />
        <title>PYROKINESIS</title>
    </head>
    <body>
        <script>
            let isAlertShow = sessionStorage.getItem('isAlertShow');
            if(!isAlertShow)
            {
                let name = prompt('Введите ваше имя');
                alert(`Добро пожаловать, ${name}`);
                sessionStorage.setItem('isAlertShow', true);
            }
        </script>
        <header class="header">
            <div class = "header_div">
                <div class = "company_name">
                    PYROKINESIS
                </div>
                <div class ="post-title-line"></div>
                <div class = "navigation">
                    <a href="index.html" class="navigation_item">Главная</a>
                    <a href="bio.html" class="navigation_item">Биография</a>
                    <a href="concerts.html" class="navigation_item">Концерты</a>
                    <a href="buy.html" class="navigation_item active">Покупка</a>
                    <a href="tickets.html" class="navigation_item">Билеты</a>
                </div>
            </div>
        </header>
        <main>
            <div class="form">
                <h1>Приобрести билет</h1>
                <div class="form__field">
                    <label for="FirstName">Имя:</label>
                    <input
                        type="text"
                        id="firstname"
                        placeholder="Введите ваше имя"
                    />
                </div>
                <div class="form__field">
                    <label for="SurName">Телефон:</label>
                    <input
                        type="phone"
                        id="surname"
                        placeholder="Введите ваш номер телефона"
                    />
                </div>
                <div class="form__field">
                    <label for="SecondName">Адрес:</label>
                    <input
                        type="text"
                        id="secondname"
                        placeholder="Введите ваше адрес"
                    />
                </div>
                <div class="form__field">
                    <label for="Phone">Телефон:</label>
                    <input
                        type="text"
                        id="phone"
                        placeholder="Введите ваше адрес"
                    />
                </div>
                <div class="form__field">
                    <label for="city">Город:</label>
                    <select name="cityes" id="city" style="width: 178px">
                        <option value="">Выберите город</option>
                        <option value="Moscow">Москва</option>
                        <option value="SPB">Санкт-Петербург</option>
                        <option value="Kazan">Казань</option>
                        <option value="VRN">Воронеж</option>
                    </select>
                </div>
                <button type="button" class="form__button" onclick="submit()">
                    Оформить
                </button>
            </div>
        </main>
    </body>
</html>
<script lang="javascript">
    const url = 'https://snowland-server.onrender.com'

    const submit = async() => {
        let name = document.getElementById('name').value;
        let phone = document.getElementById('phone').value;
        let address = document.getElementById('address').value;
        let board = document.getElementById('board').value;
        if(validate(name, phone, address, board)){
            let user = {
            name: name,
            phone: phone,
            address: address,
            board: board,
            };

            try {
                let response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json;charset=utf-8',
                    },
                    body: JSON.stringify(user),
                });
                if (response.ok) {
                    alert('Заказ успешно создан, вас перенаправит на страницу заказов')
                    setTimeout(() => {
                        window.open('orders.html', '_self');
                    }, 3000);
                } else {
                    alert('Произошла ошибка на сервере')
                }
            } catch (error) {
                alert('Ошибка ' + error)
            }
        }
    }

    const validate = (name, phone, address, board) => {
        if(name.trim() == ''){
            alert('Вы не указали имя')
            return false;
        }
        if(name && name[0].toUpperCase() !== name[0]){
            alert('Имя должно быть написано с большой буквы')
            return false;
        }
        let isPhoneNumber = new RegExp(/(\+7|8)[- _]*\(?[- _]*(\d{3}[- _]*\)?([- _]*\d){7}|\d\d[- _]*\d\d[- _]*\)?([- _]*\d){6})/g);
        if (!isPhoneNumber.test(phone)){
            alert('Неверно указан номер телефона');
            return false;
        }
        if(address.length < 5) {
            alert('Длина адреса должна быть не менее 5 символов')
            return false;
        }
        if(board == ''){
            alert('Выберите товар')
            return false;
        }
        return true
    }
</script>